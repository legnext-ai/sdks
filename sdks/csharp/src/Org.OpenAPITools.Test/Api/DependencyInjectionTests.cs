/*
 * Midjourney api-unofficial by Legnext.ai
 *
 * # **Legnext.ai Midjourney API: The Ultimate AI Image Generation Toolkit**  Unlock the full creative potential of Midjourney directly within your applications and development workflows using the **Legnext.ai Midjourney API (Unofficial)**. This comprehensive collection offers a ready-to-integrate solution for professional image and video creation, manipulation, and high-fidelity upscaling.  We provide developers with **stable, high-performance API access** to the Midjourney model. Crucially, integrating our service requires **no Midjourney account**, eliminating the hassle of managing official subscriptions or Discord interactions. Our toolkit simplifies the entire text-to-image process, supporting complex prompts, aspect ratio adjustments, and advanced style parameters.  Focus on innovation while we handle the AI infrastructure. Start building scalable, visually stunning applications today with reliable access to the worldâ€™s leading generative AI model.
 *
 * The version of the OpenAPI document: 1.0.0
 * Generated by: https://github.com/openapitools/openapi-generator.git
 */

using System;
using Microsoft.Extensions.Hosting;
using Microsoft.Extensions.DependencyInjection;
using System.Collections.Generic;
using System.Security.Cryptography;
using Org.OpenAPITools.Client;
using Org.OpenAPITools.Api;
using Org.OpenAPITools.Extensions;
using Xunit;

namespace Org.OpenAPITools.Test.Api
{
    /// <summary>
    ///  Tests the dependency injection.
    /// </summary>
    public class DependencyInjectionTest
    {
        private readonly IHost _hostUsingConfigureWithoutAClient =
            Host.CreateDefaultBuilder([]).ConfigureApi((context, services, options) =>
            {

            })
            .Build();

        private readonly IHost _hostUsingConfigureWithAClient =
            Host.CreateDefaultBuilder([]).ConfigureApi((context, services, options) =>
            {

                options.AddApiHttpClients(client => client.BaseAddress = new Uri(ClientUtils.BASE_ADDRESS));
            })
            .Build();

        private readonly IHost _hostUsingAddWithoutAClient =
            Host.CreateDefaultBuilder([]).ConfigureServices((host, services) =>
            {
                services.AddApi(options =>
                {

                });
            })
            .Build();

        private readonly IHost _hostUsingAddWithAClient =
            Host.CreateDefaultBuilder([]).ConfigureServices((host, services) =>
            {
                services.AddApi(options =>
                {

                    options.AddApiHttpClients(client => client.BaseAddress = new Uri(ClientUtils.BASE_ADDRESS));
                });
            })
            .Build();

        /// <summary>
        /// Test dependency injection when using the configure method
        /// </summary>
        [Fact]
        public void ConfigureApiWithAClientTest()
        {
            var accountManagementApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<IAccountManagementApi>();
            Assert.True(accountManagementApi.HttpClient.BaseAddress != null);

            var imageApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<IImageApi>();
            Assert.True(imageApi.HttpClient.BaseAddress != null);

            var videoApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<IVideoApi>();
            Assert.True(videoApi.HttpClient.BaseAddress != null);
        }

        /// <summary>
        /// Test dependency injection when using the configure method
        /// </summary>
        [Fact]
        public void ConfigureApiWithoutAClientTest()
        {
            var accountManagementApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<IAccountManagementApi>();
            Assert.True(accountManagementApi.HttpClient.BaseAddress != null);

            var imageApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<IImageApi>();
            Assert.True(imageApi.HttpClient.BaseAddress != null);

            var videoApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<IVideoApi>();
            Assert.True(videoApi.HttpClient.BaseAddress != null);
        }

        /// <summary>
        /// Test dependency injection when using the add method
        /// </summary>
        [Fact]
        public void AddApiWithAClientTest()
        {
            var accountManagementApi = _hostUsingAddWithAClient.Services.GetRequiredService<IAccountManagementApi>();
            Assert.True(accountManagementApi.HttpClient.BaseAddress != null);
            
            var imageApi = _hostUsingAddWithAClient.Services.GetRequiredService<IImageApi>();
            Assert.True(imageApi.HttpClient.BaseAddress != null);
            
            var videoApi = _hostUsingAddWithAClient.Services.GetRequiredService<IVideoApi>();
            Assert.True(videoApi.HttpClient.BaseAddress != null);
        }

        /// <summary>
        /// Test dependency injection when using the add method
        /// </summary>
        [Fact]
        public void AddApiWithoutAClientTest()
        {
            var accountManagementApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<IAccountManagementApi>();
            Assert.True(accountManagementApi.HttpClient.BaseAddress != null);

            var imageApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<IImageApi>();
            Assert.True(imageApi.HttpClient.BaseAddress != null);

            var videoApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<IVideoApi>();
            Assert.True(videoApi.HttpClient.BaseAddress != null);
        }
    }
}
